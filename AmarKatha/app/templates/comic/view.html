{% extends "base.html" %}

{% block title %}{{ comic.title }} - Amar Katha{% endblock %}

{% block extra_css %}
<style>
    .comic-page {
        max-width: 100%;
        height: auto;
        margin: 0 auto;
    }
    .page-container {
        min-height: 80vh;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    .navigation-buttons {
        position: fixed;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        z-index: 1000;
    }
</style>
{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="{{ url_for('main.index') }}">Home</a></li>
                <li class="breadcrumb-item active">{{ comic.title }}</li>
            </ol>
        </nav>
    </div>
</div>

<div class="row mb-4">
    <div class="col">
        <h1>{{ comic.title }}</h1>
        <p class="text-muted">By {{ comic.author.username }}</p>
        <p>{{ comic.description }}</p>
    </div>
</div>

<div class="row">
    <div class="col">
        <div class="page-container">
            {% if comic.pages.count() > 0 %}
                <img src="{{ url_for('static', filename=comic.pages[0].image_path) }}" class="comic-page" alt="Page 1">
            {% else %}
                <div class="alert alert-info">
                    This comic has no pages yet.
                </div>
            {% endif %}
        </div>
    </div>
</div>

{% if comic.pages.count() > 0 %}
<div class="navigation-buttons">
    <div class="btn-group" role="group">
        <button class="btn btn-primary" id="prevPage" disabled>
            <i class="bi bi-arrow-left"></i> Previous
        </button>
        <button class="btn btn-primary" id="nextPage">
            Next <i class="bi bi-arrow-right"></i>
        </button>
    </div>
</div>
{% endif %}

{% if current_user.id == comic.author_id %}
<div class="row mt-4">
    <div class="col">
        <div class="d-flex gap-2">
            <a href="{{ url_for('comic.edit_comic', comic_id=comic.id) }}" class="btn btn-outline-primary">
                <i class="bi bi-pencil"></i> Edit Comic
            </a>
            {% if not comic.is_published %}
            <form method="POST" action="{{ url_for('comic.publish_comic', comic_id=comic.id) }}" class="d-inline">
                <button type="submit" class="btn btn-success">
                    <i class="bi bi-globe"></i> Publish Comic
                </button>
            </form>
            {% endif %}
        </div>
    </div>
</div>
{% endif %}
{% endblock %}

{% block extra_js %}
<script>
    let currentPage = 0;
    const totalPages = {{ comic.pages.count() }};
    const pages = [
        {% for page in comic.pages %}
            "{{ url_for('static', filename=page.image_path) }}",
        {% endfor %}
    ];

    function updatePage() {
        const img = document.querySelector('.comic-page');
        img.src = pages[currentPage];
        
        document.getElementById('prevPage').disabled = currentPage === 0;
        document.getElementById('nextPage').disabled = currentPage === totalPages - 1;
    }

    document.getElementById('prevPage').addEventListener('click', () => {
        if (currentPage > 0) {
            currentPage--;
            updatePage();
        }
    });

    document.getElementById('nextPage').addEventListener('click', () => {
        if (currentPage < totalPages - 1) {
            currentPage++;
            updatePage();
        }
    });
</script>
{% endblock %} 